<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Engine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background: var(--dark);
            color: white;
            padding: 20px 0;
            transition: all 0.3s;
        }
        
        .logo {
            text-align: center;
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .logo span {
            color: var(--success);
        }
        
        .menu {
            list-style: none;
        }
        
        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .menu-item:hover, .menu-item.active {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--primary);
        }
        
        .menu-item i {
            margin-right: 10px;
            font-size: 18px;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .role-badge {
            background: var(--secondary);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        /* Card Styles */
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-gray);
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 16px;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--secondary);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
        }
        
        /* Content Generation Styles */
        .content-preview {
            background: var(--light);
            padding: 20px;
            border-radius: 6px;
            margin-top: 20px;
            white-space: pre-line;
        }
        
        .content-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* Calendar Styles */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        
        .calendar-header {
            grid-column: span 7;
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .day-header {
            text-align: center;
            font-weight: 600;
            padding: 10px;
            background: var(--light);
            border-radius: 6px;
        }
        
        .calendar-day {
            height: 100px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            padding: 8px;
            overflow-y: auto;
        }
        
        .calendar-day.has-content {
            background: rgba(67, 97, 238, 0.1);
            cursor: pointer;
        }
        
        .scheduled-item {
            font-size: 12px;
            padding: 4px;
            background: var(--success);
            color: white;
            border-radius: 4px;
            margin-bottom: 4px;
            cursor: pointer;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* API Key Section */
        .api-key-container {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .api-key-form {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .api-key-form input {
            flex: 1;
        }
        
        /* Loading Animation */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Generated Image Styles */
        .generated-image {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .menu {
                display: flex;
                overflow-x: auto;
            }
            
            .menu-item {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">Manage <span>Engine</span></div>
            <ul class="menu">
                <li class="menu-item active" data-tab="dashboard"><i class="fas fa-home"></i> Dashboard</li>
                <li class="menu-item" data-tab="brainstorming"><i class="fas fa-lightbulb"></i> Brainstorming</li>
                <li class="menu-item" data-tab="content-generation"><i class="fas fa-edit"></i> Content Generation</li>
                <li class="menu-item" data-tab="review"><i class="fas fa-check-circle"></i> Review Content</li>
                <li class="menu-item" data-tab="calendar"><i class="fas fa-calendar-alt"></i> Calendar</li>
                <li class="menu-item" data-tab="publishing"><i class="fas fa-paper-plane"></i> Publishing</li>
                <li class="menu-item admin-only" data-tab="iam" style="display: none;"><i class="fas fa-users-cog"></i> User Management</li>
                <li class="menu-item" data-tab="settings"><i class="fas fa-cog"></i> Settings</li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>Manage Engine</h1>
                <div class="user-info">
                    <div class="user-avatar">JS</div>
                    <div>
                        John Smith <span class="role-badge" id="current-role">Admin</span>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <div class="card">
                    <div class="card-header">Dashboard</div>
                    <div class="card-body">
                        <h2>Welcome to Manage Engine</h2>
                        <p>Streamline your content creation process with AI-powered ideation, generation, and scheduling.</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
                            <div class="card">
                                <div class="card-header">Content Statistics</div>
                                <div class="card-body">
                                    <p><strong>15</strong> Blog Posts Generated</p>
                                    <p><strong>32</strong> Social Media Posts</p>
                                    <p><strong>28</strong> Posts Scheduled</p>
                                    <p><strong>5</strong> Posts Need Review</p>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">Upcoming Posts</div>
                                <div class="card-body">
                                    <p><strong>Tomorrow:</strong> Blog Post - "AI in Content Marketing"</p>
                                    <p><strong>In 2 days:</strong> LinkedIn Post - "Tips for Engaging Content"</p>
                                    <p><strong>In 3 days:</strong> Blog Post - "Social Media Strategies 2023"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Brainstorming Tab -->
            <div class="tab-content" id="brainstorming">
                <div class="card">
                    <div class="card-header">Brainstorming Input</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="topics">Enter key topics or ideas from your meeting (one per line):</label>
                            <textarea id="topics" placeholder="Enter 10-20 key points or topics for the next month"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="content-type">Primary Content Type:</label>
                            <select id="content-type">
                                <option value="mixed">Mixed (Blogs and Social Media)</option>
                                <option value="blogs">Blog Posts Only</option>
                                <option value="social">Social Media Only</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="generate-plan">Generate Content Plan</button>
                        
                        <div id="content-plan" style="display: none; margin-top: 30px;">
                            <h3>Generated Content Plan</h3>
                            <div class="content-preview">
                                <p>Based on your input, we've generated a content plan with:</p>
                                <ul>
                                    <li>8 Blog Posts</li>
                                    <li>20 LinkedIn Posts</li>
                                </ul>
                                <div class="content-actions">
                                    <button class="btn btn-primary" id="approve-plan">Approve Plan</button>
                                    <button class="btn btn-warning" id="regenerate-plan">Regenerate</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content Generation Tab -->
            <div class="tab-content" id="content-generation">
                <div class="card">
                    <div class="card-header">Content Generation</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="content-topic">Topic:</label>
                            <input type="text" id="content-topic" placeholder="Enter topic for content generation">
                        </div>
                        <div class="form-group">
                            <label for="content-style">Style/Tone:</label>
                            <select id="content-style">
                                <option value="professional">Professional</option>
                                <option value="casual">Casual</option>
                                <option value="enthusiastic">Enthusiastic</option>
                                <option value="informative">Informative</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="content-type-gen">Content Type:</label>
                            <select id="content-type-gen">
                                <option value="blog">Blog Post</option>
                                <option value="linkedin">LinkedIn Post</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="generate-image" checked>
                                Generate accompanying image
                            </label>
                        </div>
                        <button class="btn btn-primary" id="generate-content">Generate Content</button>
                        
                        <div id="generated-content" style="display: none; margin-top: 30px;">
                            <h3>Generated Content</h3>
                            <div class="content-preview" id="content-output">
                                <!-- AI generated content will appear here -->
                            </div>
                            <div id="image-output">
                                <!-- Generated image will appear here -->
                            </div>
                            <div class="content-actions">
                                <button class="btn btn-success" id="approve-content">Approve Content</button>
                                <button class="btn btn-warning" id="regenerate-content">Regenerate</button>
                                <button class="btn btn-primary" id="edit-content">Edit</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Review Tab -->
            <div class="tab-content" id="review">
                <div class="card">
                    <div class="card-header">Content Review</div>
                    <div class="card-body">
                        <div class="tabs">
                            <div class="tab active" data-review-tab="pending">Pending Review</div>
                            <div class="tab" data-review-tab="approved">Approved</div>
                            <div class="tab" data-review-tab="all">All Content</div>
                        </div>
                        
                        <div class="review-content">
                            <div class="card">
                                <div class="card-header">
                                    Blog Post: The Future of AI in Marketing
                                    <span style="font-size: 14px; color: var(--gray);">Generated on: Oct 15, 2023</span>
                                </div>
                                <div class="card-body">
                                    <p>Artificial intelligence is revolutionizing the marketing landscape. From personalized content recommendations to predictive analytics, AI enables marketers to engage with their audience in more meaningful ways.</p>
                                    <div class="content-actions">
                                        <button class="btn btn-success">Approve</button>
                                        <button class="btn btn-warning">Request Changes</button>
                                        <button class="btn btn-primary">Edit</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    LinkedIn Post: Content Strategy Tips
                                    <span style="font-size: 14px; color: var(--gray);">Generated on: Oct 14, 2023</span>
                                </div>
                                <div class="card-body">
                                    <p>Looking to improve your content strategy? Here are 5 tips: 1. Know your audience 2. Create valuable content 3. Be consistent 4. Repurpose content 5. Analyze and adapt. #ContentStrategy #Marketing</p>
                                    <div class="content-actions">
                                        <button class="btn btn-success">Approve</button>
                                        <button class="btn btn-warning">Request Changes</button>
                                        <button class="btn btn-primary">Edit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Calendar Tab -->
            <div class="tab-content" id="calendar">
                <div class="card">
                    <div class="card-header">
                        Content Calendar - November 2023
                        <div>
                            <button class="btn btn-primary">Previous</button>
                            <button class="btn btn-primary">Next</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="calendar">
                            <div class="calendar-header">November 2023</div>
                            <div class="day-header">Sun</div>
                            <div class="day-header">Mon</div>
                            <div class="day-header">Tue</div>
                            <div class="day-header">Wed</div>
                            <div class="day-header">Thu</div>
                            <div class="day-header">Fri</div>
                            <div class="day-header">Sat</div>
                            
                            <!-- Empty days for the start of the month -->
                            <div class="calendar-day"></div>
                            <div class="calendar-day"></div>
                            <div class="calendar-day"></div>
                            <div class="calendar-day"><div class="scheduled-item">Blog Post: AI in Marketing</div></div>
                            <div class="calendar-day"></div>
                            <div class="calendar-day"><div class="scheduled-item">LinkedIn: Strategy Tips</div></div>
                            <div class="calendar-day"></div>
                            
                            <!-- Week 2 -->
                            <div class="calendar-day">5</div>
                            <div class="calendar-day">6</div>
                            <div class="calendar-day">7</div>
                            <div class="calendar-day">8</div>
                            <div class="calendar-day">9</div>
                            <div class="calendar-day">10</div>
                            <div class="calendar-day">11</div>
                            
                            <!-- Week 3 -->
                            <div class="calendar-day">12</div>
                            <div class="calendar-day">13</div>
                            <div class="calendar-day">14<div class="scheduled-item">Blog: Content Trends</div></div>
                            <div class="calendar-day">15</div>
                            <div class="calendar-day">16<div class="scheduled-item">LinkedIn: Engagement</div></div>
                            <div class="calendar-day">17</div>
                            <div class="calendar-day">18</div>
                            
                            <!-- Week 4 -->
                            <div class="calendar-day">19</div>
                            <div class="calendar-day">20</div>
                            <div class="calendar-day">21</div>
                            <div class="calendar-day">22<div class="scheduled-item">Blog: SEO Strategies</div></div>
                            <div class="calendar-day">23</div>
                            <div class="calendar-day">24</div>
                            <div class="calendar-day">25</div>
                            
                            <!-- Week 5 -->
                            <div class="calendar-day">26</div>
                            <div class="calendar-day">27</div>
                            <div class="calendar-day">28<div class="scheduled-item">LinkedIn: Analytics</div></div>
                            <div class="calendar-day">29</div>
                            <div class="calendar-day">30</div>
                            <div class="calendar-day"></div>
                            <div class="calendar-day"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Publishing Tab -->
            <div class="tab-content" id="publishing">
                <div class="card">
                    <div class="card-header">Publishing Controls</div>
                    <div class="card-body">
                        <h3>Scheduled Posts</h3>
                        <div class="card" style="margin-top: 20px;">
                            <div class="card-header">
                                Blog Post: The Future of AI in Marketing
                                <span class="role-badge">Scheduled: Nov 4, 2023 at 10:00 AM</span>
                            </div>
                            <div class="card-body">
                                <p>Status: <span style="color: green;">Approved</span></p>
                                <p>Channel: Company Blog</p>
                                <div class="content-actions">
                                    <button class="btn btn-success">Publish Now</button>
                                    <button class="btn btn-primary">Reschedule</button>
                                    <button class="btn btn-warning">Unpublish</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                LinkedIn Post: Content Strategy Tips
                                <span class="role-badge">Scheduled: Nov 6, 2023 at 2:30 PM</span>
                            </div>
                            <div class="card-body">
                                <p>Status: <span style="color: green;">Approved</span></p>
                                <p>Channel: LinkedIn Company Page</p>
                                <div class="content-actions">
                                    <button class="btn btn-success">Publish Now</button>
                                    <button class="btn btn-primary">Reschedule</button>
                                    <button class="btn btn-warning">Unpublish</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- IAM Tab (Admin Only) -->
            <div class="tab-content" id="iam">
                <div class="card">
                    <div class="card-header">User Management (Super Admin Only)</div>
                    <div class="card-body">
                        <h3>Manage Users and Roles</h3>
                        
                        <div class="card" style="margin-top: 20px;">
                            <div class="card-header">Current Users</div>
                            <div class="card-body">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="border-bottom: 1px solid var(--light-gray);">
                                            <th style="text-align: left; padding: 10px;">User</th>
                                            <th style="text-align: left; padding: 10px;">Email</th>
                                            <th style="text-align: left; padding: 10px;">Role</th>
                                            <th style="text-align: left; padding: 10px;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid var(--light-gray);">
                                            <td style="padding: 10px;">John Smith</td>
                                            <td style="padding: 10px;">john@example.com</td>
                                            <td style="padding: 10px;">
                                                <select>
                                                    <option selected>Super Admin</option>
                                                    <option>Admin</option>
                                                    <option>User</option>
                                                </select>
                                            </td>
                                            <td style="padding: 10px;">
                                                <button class="btn btn-primary">Save</button>
                                                <button class="btn btn-warning">Remove</button>
                                            </td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid var(--light-gray);">
                                            <td style="padding: 10px;">Jane Doe</td>
                                            <td style="padding: 10px;">jane@example.com</td>
                                            <td style="padding: 10px;">
                                                <select>
                                                    <option>Super Admin</option>
                                                    <option selected>Admin</option>
                                                    <option>User</option>
                                                </select>
                                            </td>
                                            <td style="padding: 10px;">
                                                <button class="btn btn-primary">Save</button>
                                                <button class="btn btn-warning">Remove</button>
                                            </td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid var(--light-gray);">
                                            <td style="padding: 10px;">Bob Johnson</td>
                                            <td style="padding: 10px;">bob@example.com</td>
                                            <td style="padding: 10px;">
                                                <select>
                                                    <option>Super Admin</option>
                                                    <option>Admin</option>
                                                    <option selected>User</option>
                                                </select>
                                            </td>
                                            <td style="padding: 10px;">
                                                <button class="btn btn-primary">Save</button>
                                                <button class="btn btn-warning">Remove</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <h4 style="margin-top: 20px;">Add New User</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; margin-top: 10px;">
                                    <input type="text" placeholder="Full Name">
                                    <input type="email" placeholder="Email">
                                    <select>
                                        <option>Select Role</option>
                                        <option>Super Admin</option>
                                        <option>Admin</option>
                                        <option>User</option>
                                    </select>
                                    <button class="btn btn-primary">Add User</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div class="tab-content" id="settings">
                <div class="card">
                    <div class="card-header">Settings</div>
                    <div class="card-body">
                        <div class="api-key-container">
                            <h3>API Configuration</h3>
                            <p>Configure your API keys for content generation. These keys are stored locally in your browser.</p>
                            
                            <div class="form-group">
                                <label for="gemini-api-key">Gemini API Key:</label>
                                <div class="api-key-form">
                                    <input type="password" id="gemini-api-key" placeholder="Enter your Gemini API key">
                                    <button class="btn btn-primary" id="save-gemini-key">Save Key</button>
                                </div>
                                <small>You can get your API key from <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a></small>
                            </div>
                            
                            <div class="form-group">
                                <label for="dalle-api-key">DALL-E API Key:</label>
                                <div class="api-key-form">
                                    <input type="password" id="dalle-api-key" placeholder="Enter your DALL-E API key">
                                    <button class="btn btn-primary" id="save-dalle-key">Save Key</button>
                                </div>
                                <small>Azure OpenAI DALL-E API key</small>
                            </div>
                            
                            <div id="api-key-status" style="margin-top: 10px;"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="default-style">Default Content Style:</label>
                            <select id="default-style">
                                <option value="professional">Professional</option>
                                <option value="casual">Casual</option>
                                <option value="enthusiastic">Enthusiastic</option>
                                <option value="informative">Informative</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="auto-save">Auto-save Content:</label>
                            <input type="checkbox" id="auto-save" checked>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Backend server URL
        const BACKEND_URL = 'http://localhost:3000';
        
        // Tab switching functionality
        const menuItems = document.querySelectorAll('.menu-item');
        const tabContents = document.querySelectorAll('.tab-content');
        
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Activate menu item
                menuItems.forEach(mi => mi.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding tab content
                tabContents.forEach(tab => tab.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Review tabs
        const reviewTabs = document.querySelectorAll('[data-review-tab]');
        reviewTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                reviewTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Generate content plan
        document.getElementById('generate-plan').addEventListener('click', function() {
            document.getElementById('content-plan').style.display = 'block';
        });
        
        // Generate content with Gemini API
        document.getElementById('generate-content').addEventListener('click', async function() {
            const topic = document.getElementById('content-topic').value;
            const style = document.getElementById('content-style').value;
            const contentType = document.getElementById('content-type-gen').value;
            const generateImage = document.getElementById('generate-image').checked;
            const geminiApiKey = localStorage.getItem('gemini-api-key') || 'AIzaSyCmsZElPNizIR_3dTC1Myfp3MG5GHmRBtI';
            
            if (!topic) {
                alert('Please enter a topic first');
                return;
            }
            
            // Show loading state
            const generateBtn = document.getElementById('generate-content');
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<span class="loader"></span> Generating...';
            generateBtn.disabled = true;
            
            try {
                let prompt = '';
                if (contentType === 'blog') {
                    prompt = `Write a ${style} blog post about "${topic}". The blog should be engaging, informative, and well-structured with an introduction, body, and conclusion. Use markdown formatting for headings and lists.`;
                } else {
                    prompt = `Write a ${style} LinkedIn post about "${topic}". Keep it concise, professional, and engaging with relevant hashtags. Maximum 300 characters.`;
                }
                
                // Call Gemini API
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                parts: [
                                    {
                                        text: prompt
                                    }
                                ]
                            }
                        ]
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to generate content');
                }
                
                const data = await response.json();
                const generatedText = data.candidates[0].content.parts[0].text;
                
                // Display the generated content
                document.getElementById('content-output').textContent = generatedText;
                document.getElementById('generated-content').style.display = 'block';
                
                // Generate image if requested
                if (generateImage) {
                    await generateImageForContent(topic, contentType, generatedText);
                }
                
            } catch (error) {
                console.error('Error generating content:', error);
                alert('Error generating content: ' + error.message);
            } finally {
                // Restore button state
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        });
        
        // CORRECTED: Function to generate image using Azure DALL-E via backend
        async function generateImageForContent(topic, contentType, textContent) {
            try {
                // Create image prompt based on content type and topic
                let imagePrompt = '';
                if (contentType === 'blog') {
                    imagePrompt = `Create a professional, high-quality blog header image for an article about "${topic}". The image should be visually appealing and relevant to the topic. Style: vivid, quality: standard.`;
                } else {
                    imagePrompt = `Create a social media image for a LinkedIn post about "${topic}". The image should be professional, engaging, and optimized for social media. Style: vivid, quality: standard.`;
                }
                
                // Show loading state for image
                document.getElementById('image-output').innerHTML = `
                    <div style="margin-top: 20px;">
                        <h4>Generating Image with Azure DALL-E...</h4>
                        <div style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; border-radius: 8px;">
                            <span class="loader"></span> Creating AI image with Azure DALL-E...
                        </div>
                    </div>
                `;
                
                // Call backend API for image generation
                const response = await fetch(`${BACKEND_URL}/api/generate-image`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: imagePrompt
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Display the generated image
                    document.getElementById('image-output').innerHTML = `
                        <div style="margin-top: 20px;">
                            <h4>✅ Azure DALL-E Generated Image</h4>
                            <img src="${result.imageUrl}" alt="Generated image for ${topic}" class="generated-image" 
                                 onerror="handleImageError(this, '${topic}')">
                            <p><small><strong>Prompt:</strong> ${imagePrompt}</small></p>
                            <p><small><strong>Size:</strong> 1024x1024 | <strong>Style:</strong> vivid | <strong>Quality:</strong> standard</small></p>
                            <div class="content-actions">
                                <button class="btn btn-primary" onclick="regenerateImage('${topic}', '${contentType}')">Regenerate Image</button>
                                <button class="btn btn-success" onclick="downloadImage('${result.imageUrl}', '${topic}')">Download Image</button>
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error(result.error);
                }
                
            } catch (error) {
                console.error('Error generating image:', error);
                // Fallback to placeholder with detailed error
                showImageError(topic, `Azure DALL-E Error: ${error.message}`);
            }
        }
        
        // Handle image loading errors
        window.handleImageError = function(imgElement, topic) {
            imgElement.style.display = 'none';
            showImageError(topic, 'Failed to load generated image - the Azure DALL-E URL may be invalid or expired');
        };
        
        // Show image error message
        function showImageError(topic, errorMessage) {
            document.getElementById('image-output').innerHTML = `
                <div style="margin-top: 20px;">
                    <h4>❌ Image Generation Failed</h4>
                    <div style="width: 100%; padding: 20px; background: #ffeaa7; border: 1px solid #fdcb6e; border-radius: 8px; color: #d63031;">
                        <strong>Error:</strong> ${errorMessage}
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                        <h5>Troubleshooting Steps:</h5>
                        <ol style="text-align: left; margin-left: 20px;">
                            <li>Make sure your backend server is running: <code>node server.js</code></li>
                            <li>Check that your Azure API key is valid in the .env file</li>
                            <li>Verify Azure endpoint configuration</li>
                            <li>Test server connection using the button below</li>
                        </ol>
                    </div>
                    <div class="content-actions" style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="testServerConnection()">Test Server Connection</button>
                        <button class="btn btn-warning" onclick="regenerateImage('${topic}')">Try Again</button>
                    </div>
                </div>
            `;
        }
        
        // Image regeneration function
        window.regenerateImage = async function(topic, contentType) {
            const contentOutput = document.getElementById('content-output').textContent;
            await generateImageForContent(topic, contentType, contentOutput);
        };
        
        // Image download function
        window.downloadImage = function(imageUrl, topic) {
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = `azure-dalle-image-${topic.replace(/\s+/g, '-').toLowerCase()}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };
        
        // Save API keys
        document.getElementById('save-gemini-key').addEventListener('click', function() {
            const apiKey = document.getElementById('gemini-api-key').value;
            if (apiKey) {
                localStorage.setItem('gemini-api-key', apiKey);
                showApiKeyStatus('Gemini API key saved successfully!', 'success');
            } else {
                showApiKeyStatus('Please enter an API key', 'error');
            }
        });
        
        document.getElementById('save-dalle-key').addEventListener('click', function() {
            const apiKey = document.getElementById('dalle-api-key').value;
            if (apiKey) {
                localStorage.setItem('dalle-api-key', apiKey);
                showApiKeyStatus('Azure DALL-E API key saved successfully!', 'success');
            } else {
                showApiKeyStatus('Please enter an API key', 'error');
            }
        });
        
        // Show API key status
        function showApiKeyStatus(message, type) {
            const color = type === 'success' ? 'green' : 'red';
            document.getElementById('api-key-status').innerHTML = 
                `<span style="color: ${color};"><strong>${type === 'success' ? '✅' : '❌'} ${message}</strong></span>`;
        }
        
        // Test server connection
        window.testServerConnection = async function() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/health`);
                if (response.ok) {
                    const data = await response.json();
                    alert('✅ Server is running correctly!\n\nStatus: ' + data.message);
                } else {
                    throw new Error('Server responded with error status: ' + response.status);
                }
            } catch (error) {
                alert('❌ Server connection failed!\n\nError: ' + error.message + 
                      '\n\nMake sure to run: node server.js');
            }
        };
        
        // Load saved API keys
        const savedGeminiKey = localStorage.getItem('gemini-api-key');
        if (savedGeminiKey) {
            document.getElementById('gemini-api-key').value = savedGeminiKey;
        }
        
        const savedDalleKey = localStorage.getItem('dalle-api-key');
        if (savedDalleKey) {
            document.getElementById('dalle-api-key').value = savedDalleKey;
        }
        
        if (savedGeminiKey || savedDalleKey) {
            showApiKeyStatus('Using saved API keys', 'success');
        }
        
        // Role simulation
        const roleSelect = document.createElement('select');
        roleSelect.innerHTML = `
            <option value="superadmin">Super Admin</option>
            <option value="admin" selected>Admin</option>
            <option value="user">User</option>
        `;
        roleSelect.style.marginLeft = '10px';
        roleSelect.addEventListener('change', function() {
            const role = this.value;
            document.getElementById('current-role').textContent = 
                role === 'superadmin' ? 'Super Admin' : 
                role === 'admin' ? 'Admin' : 'User';
            
            const adminOnlyItems = document.querySelectorAll('.admin-only');
            if (role === 'superadmin') {
                adminOnlyItems.forEach(item => item.style.display = 'block');
            } else {
                adminOnlyItems.forEach(item => item.style.display = 'none');
            }
        });
        
        document.querySelector('.user-info').appendChild(roleSelect);
        
        // Content approval functionality
        document.getElementById('approve-content').addEventListener('click', function() {
            alert('Content approved and scheduled for publishing!');
        });
        
        document.getElementById('regenerate-content').addEventListener('click', function() {
            document.getElementById('generate-content').click();
        });
        
        document.getElementById('edit-content').addEventListener('click', function() {
            const content = document.getElementById('content-output').textContent;
            const newContent = prompt('Edit your content:', content);
            if (newContent !== null) {
                document.getElementById('content-output').textContent = newContent;
            }
        });
        
        // Add missing CSS
        const style = document.createElement('style');
        style.textContent = `
            .image-placeholder {
                width: 100%;
                height: 200px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 18px;
                border-radius: 8px;
                margin-top: 15px;
            }
            .generated-image {
                max-width: 100%;
                border-radius: 8px;
                margin-top: 15px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }
        `;
        document.head.appendChild(style);
        
        // Test server connection on load
        checkServerConnection();
        
        async function checkServerConnection() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/health`);
                if (response.ok) {
                    console.log('✅ Server is running');
                }
            } catch (error) {
                console.warn('❌ Server is not running - make sure to run: node server.js');
            }
        }
    });
</script>
</body>
</html>